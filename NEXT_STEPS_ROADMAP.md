# DCAS 后续步骤路线图

更新日期：2026-02-27

## 1. 目标与范围
本路线图用于把当前 DCAS 原型（解纠缠 + OT 推荐 + PAL）推进到“可持续迭代的真实数据训练系统”。

核心目标：
- 建立可复用的数据集构建流程，而非仅依赖 toy 数据。
- 完成跨文化推荐的可量化评估闭环（效果 + 公平性 + 可解释性）。
- 打通专家反馈到模型再训练的 PAL 迭代流程。

## 2. 分阶段执行路线

## 阶段 0：基线冻结（1-2 天）
任务：
- 固化当前可运行链路：toy 数据生成、训练、推荐、PAL 导出。
- 记录基线指标：`serendipity`、`cultural_calibration_kl`、训练损失曲线。
- 输出一份基线报告（参数、数据版本、结果）。

交付物：
- `reports/baseline_2026-02-27.md`
- 可复现实验命令清单

验收标准：
- 同一随机种子下结果波动可控。
- 全流程命令在本机可一次跑通。

## 阶段 1：数据集建设 v1（1-2 周）
任务：
- 定义数据规范：
  - `tracks.npz`：`track_id/culture/embedding/affect_label(optional)`
  - `interactions.csv`：`user_id,track_id,weight,timestamp(optional)`
- 建立数据处理脚本：原始元数据 -> 清洗 -> 特征对齐 -> 导出 `tracks.npz`。
- 增加数据质检：缺失值、重复曲目、文化标签稀疏度、embedding 维度一致性。
- 划分训练/验证/测试集（按用户与文化分层抽样）。

交付物：
- `dcas/scripts/build_dataset.py`（建议）
- `storage/datasets/v1/`（真实数据集）
- `reports/dataset_v1_profile.md`

验收标准：
- 至少 3 个文化域可用。
- 每个文化域具备最小样本量（建议 >= 500 首）。
- 脚本可重复生成同结构数据集。

## 阶段 2：表征升级与训练策略（1-2 周）
任务：
- 接入真实音频 embedding 来源（优先 CultureMERT 或已提取特征）。
- 为训练增加配置管理（学习率、损失权重、种子、设备）。
- 明确 `zc/zs/za` 的目标约束与 ablation 计划（是否启用 domain/contrast/constraints）。

交付物：
- `configs/train/*.yaml`（建议）
- `reports/ablation_v1.md`

验收标准：
- 相比阶段 0 基线，至少有一个核心指标稳定提升。
- 至少完成 3 组对照实验（含是否开启领域对抗）。

## 阶段 3：推荐与对齐优化（1 周）
任务：
- 调优 OT 参数：`epsilon`、`iters`、候选池规模。
- 补充失败兜底策略：目标文化样本不足、冷启动用户、空交互用户。
- 引入推荐结果解释字段（为何推荐：情感接近/风格差异）。

交付物：
- 推荐评测报告（离线）
- API 返回扩展字段文档

验收标准：
- `serendipity` 与相关性指标达到平衡（不出现单边极端）。
- 冷启动/低样本场景可稳定返回结果。

## 阶段 4：PAL 闭环（1-2 周）
任务：
- 将 PAL 导出的 `pal_tasks.jsonl` 形成标注工作流。
- 增加“专家反馈 -> pairwise constraints -> 再训练”自动化入口。
- 记录每轮 PAL 的收益（标注量 vs 指标提升）。

交付物：
- `storage/pal/round_x/` 数据归档规范
- `reports/pal_round_x.md`

验收标准：
- 至少完成 2 轮 PAL 回灌训练。
- 每轮能产出可比对的指标变化。

## 阶段 5：评估体系完善（1 周）
任务：
- 增加解纠缠与公平性评估：
  - Disentanglement（可先用 proxy 指标）
  - Minority Exposure@K
  - Cultural Calibration Error
- 建立统一评测脚本，输出固定格式报告。

交付物：
- `dcas/cli/eval.py`（建议）
- `reports/eval_suite_v1.md`

验收标准：
- 单条命令可产出完整离线评测。
- 评测结果可用于版本间横向比较。

## 阶段 6：工程化与发布准备（1 周）
任务：
- 规范模型与数据版本命名（dataset/model/report 一一对应）。
- API 输入校验与异常处理补全（路径、空数据、参数边界）。
- 增加最小测试集：数据加载、训练入口、推荐入口、PAL 入口。

交付物：
- 发布候选版本（RC）
- 最小回归测试清单

验收标准：
- 关键链路测试通过。
- 版本可回滚、可追溯、可复现。

## 3. 近期两周优先级（建议）
第 1 周：
- 完成阶段 0 + 阶段 1（数据规范、数据构建脚本、dataset profile）。

第 2 周：
- 完成阶段 2（训练策略与 ablation）+ 阶段 3（OT 参数调优）。

优先原则：
- 先数据，再模型；先可复现，再追求更高指标。

## 4. 关键风险与应对
风险：真实数据文化分布严重不均衡。
- 应对：训练与评测分开做重加权；报告中强制披露各文化样本占比。

风险：情感标签噪声高，影响 `za` 对齐。
- 应对：先使用弱监督 + PAL 精标样本混合训练。

风险：指标冲突（相关性上升但惊喜度下降）。
- 应对：设置双目标阈值，不以单指标最优作为上线条件。

## 5. 决策点（需要项目负责人确认）
- 数据源范围：先做 3 个文化域，还是一次扩到 5+。
- embedding 路线：先用离线预提取，还是直接接入在线特征抽取。
- PAL 组织方式：先内部小规模专家，还是开放众包预标注。

---

备注：本路线图默认基于当前仓库结构（`dcas/`、`dcas_server/`、`web/`）演进，不做大规模重构。
